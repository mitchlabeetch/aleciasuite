<div class="logs-page">
  <header class="logs-header">
    <h2>{{service.icon}} Logs - {{service.name}}</h2>
    <a href="/" class="btn">‚Üê Retour</a>
  </header>
  
  <div class="logs-container">
    <pre id="logs-output" class="logs-output"></pre>
  </div>
</div>

<script>
  const serviceName = '{{service.id}}';
  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
  const logsOutput = document.getElementById('logs-output');
  let ws;
  let reconnectAttempts = 0;
  const maxReconnects = 3;
  
  function connectWebSocket() {
    ws = new WebSocket(`${protocol}//${window.location.host}?service=${serviceName}`);
    
    ws.onmessage = (event) => {
      logsOutput.textContent += event.data;
      logsOutput.scrollTop = logsOutput.scrollHeight;
    };
    
    ws.onerror = (error) => {
      logsOutput.textContent += '\n‚ùå Erreur de connexion WebSocket\n';
    };
    
    ws.onclose = () => {
      if (reconnectAttempts < maxReconnects) {
        reconnectAttempts++;
        logsOutput.textContent += `\nüîÑ Reconnexion (tentative ${reconnectAttempts}/${maxReconnects})...\n`;
        setTimeout(connectWebSocket, 2000);
      } else {
        logsOutput.textContent += '\n‚ùå Impossible de se reconnecter. Rechargez la page.\n';
      }
    };
  }
  
  connectWebSocket();
</script>
