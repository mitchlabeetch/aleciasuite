# ==============================================================================
# Activepieces (Workflow Automation) Environment Configuration
# ==============================================================================
# This file contains all environment variables required for Activepieces deployment.
# Copy this file to .env and fill in your actual values.
#
# Activepieces Documentation: https://www.activepieces.com/docs/install/configurations/environment-variables
# ==============================================================================

# ==============================================================================
# CORE ACTIVEPIECES CONFIGURATION
# ==============================================================================

# Engine Executable Path (internal Activepieces setting)
# This points to the compiled engine JavaScript file
# Default: dist/packages/engine/main.js
AP_ENGINE_EXECUTABLE_PATH=dist/packages/engine/main.js

# Environment (prod, dev)
# Set to "prod" for production deployments
AP_ENVIRONMENT=prod

# Frontend URL (public-facing URL for Activepieces UI)
# Local dev: http://localhost:8080
# Production: https://flows.alecia.markets
AP_FRONTEND_URL=http://localhost:8080

# ==============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# ==============================================================================

# PostgreSQL Connection Details
# Used by Activepieces to store flows, users, and execution data
DATABASE_URL=postgresql://alecia:password@localhost:5432/activepieces
AP_POSTGRES_DATABASE=activepieces
AP_POSTGRES_HOST=localhost
AP_POSTGRES_PORT=5432
AP_POSTGRES_USERNAME=alecia
AP_POSTGRES_PASSWORD=changeme_postgres_password_here

# PostgreSQL SSL Mode
# Set to "true" for production with SSL, "false" for local development
AP_POSTGRES_USE_SSL=false

# ==============================================================================
# REDIS CONFIGURATION (Caching & Queue Management)
# ==============================================================================

# Redis Connection Details
# Used by Activepieces for job queues, caching, and rate limiting
AP_REDIS_HOST=localhost
AP_REDIS_PORT=6379
AP_REDIS_PASSWORD=changeme_redis_password_here

# Redis URL (alternative to separate host/port/password)
# Format: redis://:password@host:port
# REDIS_URL=redis://:changeme_redis_password_here@localhost:6379

# ==============================================================================
# SECURITY & ENCRYPTION
# ==============================================================================

# Encryption Key (for encrypting sensitive data like API keys in workflows)
# IMPORTANT: Must be exactly 32 hexadecimal characters (16 bytes)
# Generate with: openssl rand -hex 16
# Example: a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4
# This key encrypts:
# - User credentials stored in connections
# - OAuth tokens
# - API keys used in workflow steps
AP_ENCRYPTION_KEY=changeme_32_hex_characters_1234567890abcdef

# JWT Secret (for signing authentication tokens)
# Generate with: openssl rand -base64 32
# Used for user session management and API authentication
AP_JWT_SECRET=changeme_activepieces_jwt_secret_here

# ==============================================================================
# WORKFLOW EXECUTION SETTINGS
# ==============================================================================

# Execution Mode (SANDBOXED or UNSANDBOXED)
# SANDBOXED: Runs workflows in isolated containers (more secure, requires Docker)
# UNSANDBOXED: Runs workflows in the same process (faster, less secure)
# Production recommendation: SANDBOXED (if using Docker with proper permissions)
# Development: UNSANDBOXED (simpler setup)
AP_EXECUTION_MODE=UNSANDBOXED

# Flow Worker Concurrency (number of concurrent workflow executions)
# Higher values = more parallel executions but more resource usage
# Recommended: 10-50 depending on server resources
AP_FLOW_WORKER_CONCURRENCY=10

# Webhook Timeout (seconds)
# Maximum time to wait for webhook responses
AP_WEBHOOK_TIMEOUT_SECONDS=30

# Trigger Default Poll Interval (minutes)
# How often scheduled triggers poll for new data (e.g., checking for new emails)
# Lower values = more frequent checks but more load
# Recommended: 5-15 minutes
AP_TRIGGER_DEFAULT_POLL_INTERVAL=5

# ==============================================================================
# TELEMETRY & ANALYTICS
# ==============================================================================

# Telemetry Enabled (send anonymous usage data to Activepieces)
# Set to "false" to disable telemetry
AP_TELEMETRY_ENABLED=false

# ==============================================================================
# SIGN-UP & USER MANAGEMENT (Optional)
# ==============================================================================

# Sign-up Enabled (allow new user registrations)
# Set to "false" to disable public sign-ups
# AP_SIGN_UP_ENABLED=true

# ==============================================================================
# EDITION & LICENSING (Optional)
# ==============================================================================

# Activepieces Edition (ce = Community Edition, ee = Enterprise Edition)
# AP_EDITION=ce

# License Key (for Enterprise Edition only)
# Obtain from: https://www.activepieces.com/pricing
# AP_LICENSE_KEY=your-enterprise-license-key

# ==============================================================================
# SMTP / EMAIL CONFIGURATION (Optional)
# ==============================================================================

# SMTP settings for sending email notifications
# Required for: Password resets, user invitations, workflow notifications
# AP_SMTP_HOST=smtp.gmail.com
# AP_SMTP_PORT=587
# AP_SMTP_USERNAME=your-email@gmail.com
# AP_SMTP_PASSWORD=your-email-password
# AP_SMTP_USE_TLS=true
# AP_SMTP_FROM=noreply@alecia.markets

# ==============================================================================
# OAUTH PROVIDERS (Optional)
# ==============================================================================

# Google OAuth (for "Sign in with Google")
# Obtain from: https://console.cloud.google.com/apis/credentials
# AP_GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
# AP_GOOGLE_CLIENT_SECRET=your-google-client-secret

# GitHub OAuth (for "Sign in with GitHub")
# Obtain from: https://github.com/settings/developers
# AP_GITHUB_CLIENT_ID=your-github-client-id
# AP_GITHUB_CLIENT_SECRET=your-github-client-secret

# ==============================================================================
# CUSTOM PIECES (Optional)
# ==============================================================================

# Path to custom pieces directory (for extending Activepieces with custom actions)
# Example: /app/packages/pieces/community
# AP_CUSTOM_PIECES_PATH=/app/packages/pieces/community

# ==============================================================================
# LOGGING (Optional)
# ==============================================================================

# Log Level (error, warn, info, debug)
# AP_LOG_LEVEL=info

# Pretty Print Logs (for development)
# AP_LOG_PRETTY=true

# ==============================================================================
# RATE LIMITING (Optional)
# ==============================================================================

# API Rate Limiting (requests per minute)
# AP_API_RATE_LIMIT=100

# ==============================================================================
# INITIAL SETUP INSTRUCTIONS
# ==============================================================================
# 1. Copy this file: cp .env.example .env
# 2. Generate secrets:
#    - AP_ENCRYPTION_KEY: openssl rand -hex 16 (MUST be exactly 32 hex chars)
#    - AP_JWT_SECRET: openssl rand -base64 32
# 3. Update database settings (AP_POSTGRES_*) with your PostgreSQL credentials
# 4. Update Redis settings (AP_REDIS_*) with your Redis credentials
# 5. Set AP_FRONTEND_URL to your public-facing URL
# 6. Choose execution mode:
#    - UNSANDBOXED for simpler setup (development)
#    - SANDBOXED for better security (production with Docker)
# 7. Start Activepieces: npm run start:prod
# 8. Access UI at AP_FRONTEND_URL (default: http://localhost:8080)
# 9. Create first admin user through web UI
# ==============================================================================

# ==============================================================================
# DOCKER DEPLOYMENT NOTES
# ==============================================================================
# When deploying with docker-compose:
# - Database and Redis hosts should use Docker service names
#   (e.g., AP_POSTGRES_HOST=alecia-postgres, AP_REDIS_HOST=alecia-redis)
# - For SANDBOXED mode, mount Docker socket: /var/run/docker.sock
# - Ensure proper network connectivity between services
# - Use secrets management for production (not plain .env files)
# ==============================================================================

# ==============================================================================
# SECURITY BEST PRACTICES
# ==============================================================================
# - Use SANDBOXED mode in production for better isolation
# - Rotate AP_ENCRYPTION_KEY and AP_JWT_SECRET regularly
# - Enable SSL for database connections in production (AP_POSTGRES_USE_SSL=true)
# - Restrict Redis access with strong password
# - Use HTTPS for AP_FRONTEND_URL in production
# - Disable public sign-ups (AP_SIGN_UP_ENABLED=false) and manage users manually
# - Regularly update Activepieces and dependencies
# - Back up database regularly (flows and execution history)
# ==============================================================================

# ==============================================================================
# ENCRYPTION KEY FORMAT REFERENCE
# ==============================================================================
# AP_ENCRYPTION_KEY must be EXACTLY 32 hexadecimal characters (0-9, a-f).
# This represents 16 bytes of random data encoded in hexadecimal.
#
# Valid example: a1b2c3d4e5f67890abcdef1234567890
# Invalid: too short, too long, or contains non-hex characters
#
# Generation command:
# openssl rand -hex 16
#
# CRITICAL: Never change this key after workflows are created, or you'll lose
# access to all encrypted credentials!
# ==============================================================================
